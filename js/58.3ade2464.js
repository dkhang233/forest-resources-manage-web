"use strict";(self["webpackChunkforest_resources_manage_application"]=self["webpackChunkforest_resources_manage_application"]||[]).push([[58],{2012:function(e,t,a){a.d(t,{bC:function(){return l},d5:function(){return n},sE:function(){return r}});var o=a(7877);const l=e=>o.x.get(`administrations/${e}/sub`),n=e=>o.x.get(`administrations/name/${e}`),r=(e,t)=>o.x.post(`administrations/${e}`,t)},4058:function(e,t,a){a.r(t),a.d(t,{default:function(){return T}});var o=a(3396),l=a(7139);const n=e=>((0,o.dD)("data-v-251c66d4"),e=e(),(0,o.Cn)(),e),r={class:"tree"},i={class:"custom-tree-node"},s=["onClick"],d=n((()=>(0,o._)("div",{class:"card-header"},[(0,o._)("span",null,"Map")],-1))),h={class:"grid grid-cols-6 gap-4"};function m(e,t,a,n,m,u){const c=(0,o.up)("font-awesome-icon"),p=(0,o.up)("el-input"),f=(0,o.up)("el-tree-v2"),g=(0,o.up)("el-card"),b=(0,o.up)("el-col"),v=(0,o.up)("map-view"),w=(0,o.up)("el-row"),y=(0,o.up)("el-form-item"),x=(0,o.up)("el-option"),_=(0,o.up)("el-select"),V=(0,o.up)("el-form"),W=(0,o.up)("el-dialog"),C=(0,o.Q2)("loading");return(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",r,[(0,o.Wm)(w,{gutter:50},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{span:10},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{class:"administrations"},{header:(0,o.w5)((()=>[(0,o.Wm)(c,{icon:["fas","magnifying-glass"],flip:"horizontal",size:"lg"}),(0,o.Wm)(p,{offset:2,modelValue:m.filterText,"onUpdate:modelValue":t[0]||(t[0]=e=>m.filterText=e),placeholder:"Filter keyword",class:"form"},null,8,["modelValue"])])),default:(0,o.w5)((()=>[(0,o.Wm)(f,{"default-expand-all":"",ref:"treeRef",class:"el-tree",data:m.treeData,props:m.defaultProps,"item-size":50,"expand-on-click-node":!1,"filter-method":u.filterNode,height:500},{default:(0,o.w5)((({node:e,data:t})=>[(0,o._)("span",i,[(0,o._)("span",null,(0,l.zw)(e.label),1),(0,o._)("a",{class:"text-blue-500 ml-[100px] hover:text-blue-300",onClick:e=>u.showNode(t)},"Chi tiết",8,s)])])),_:1},8,["data","props","filter-method"])])),_:1})])),_:1}),(0,o.Wm)(b,{span:13},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{class:"box-card"},{header:(0,o.w5)((()=>[d])),default:(0,o.w5)((()=>[(0,o.Wm)(v,{class:"map"})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(W,{modelValue:m.dialogFormVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>m.dialogFormVisible=e),title:"Thông tin đơn vị hành chính"},{footer:(0,o.w5)((()=>[(0,o._)("span",h,[(0,o._)("button",{class:"p-2 mr-5 space-x-[100px] font-sans font-bold text-white rounded-lg shadow-lg px-5 bg-red-500 shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:t[5]||(t[5]=(...e)=>u.deleteBtn&&u.deleteBtn(...e))}," Xóa "),(0,o._)("button",{class:"p-2 mr-3 col-start-5 font-sans font-bold text-white rounded-lg shadow-lg px-5 bg-[#839192] shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:t[6]||(t[6]=e=>m.dialogFormVisible=!1)}," Quay lại "),(0,o._)("button",{class:"p-2 col-start-6 font-sans font-bold text-white rounded-lg shadow-lg px-5 bg-blue-500 shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:t[7]||(t[7]=e=>u.updateBtn(this.$refs.ruleFormRef))}," Cập nhập ")])])),default:(0,o.w5)((()=>[(0,o.Wm)(V,{ref:"ruleFormRef",model:m.form,"status-icon":"",rules:m.rules},{default:(0,o.w5)((()=>[(0,o.Wm)(y,{label:"Mã",prop:"code"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:m.form.code,"onUpdate:modelValue":t[1]||(t[1]=e=>m.form.code=e),autocomplete:"off",disabled:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(y,{label:"Cấp Hành Chính",prop:"level"},{default:(0,o.w5)((()=>[(0,o.Wm)(_,{modelValue:m.form.level,"onUpdate:modelValue":t[2]||(t[2]=e=>m.form.level=e),placeholder:"Chọn cấp hành chính"},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{label:"xã",value:"xã"}),(0,o.Wm)(x,{label:"thị trấn",value:"thị trấn"}),(0,o.Wm)(x,{label:"huyện",value:"huyện"}),(0,o.Wm)(x,{label:"thành phố",value:"thành phố"}),(0,o.Wm)(x,{label:"tỉnh",value:"tỉnh"})])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(y,{label:"Tên",prop:"name"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:m.form.name,"onUpdate:modelValue":t[3]||(t[3]=e=>m.form.name=e),placeholder:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(y,{label:"Trực thuộc",prop:"sub"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:m.form.subName,"onUpdate:modelValue":t[4]||(t[4]=e=>m.form.subName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),[[C,m.loadingStatus]])}var u=a(2012),c=a(1020),p=a(7322);const f={id:"mapContainer"};function g(e,t,a,l,n,r){return(0,o.wg)(),(0,o.iD)("div",f)}a(560);var b=a(3153),v=a.n(b),w=a(7877);const y=e=>w.Y.get(`relation/${e}.json`),x=e=>w.Y.get(`way/${e}/full.json`);var _={data(){return{map:null}},methods:{retrieveDataOfRelation(e){y(e).then((e=>{try{let t=e.data.elements[0].members;for(let e in t)"way"==t[e].type&&(this.retrieveDataOfWay(t[e].ref),console.log(e+" : "+t[e].ref))}catch(t){console.log(t)}})).catch((e=>{console.log(e)}))},retrieveDataOfWay(e){x(e).then((e=>{try{let a=new Map,o=[],l=null,n=e.data.elements;for(let e in n)"node"==n[e].type&&null!=n[e].lat&&a.set(n[e].id,[n[e].lat,n[e].lon]),"way"==n[e].type&&(l=n[e]);for(let e in l.nodes)o.push(a.get(l.nodes[e]));var t=o;v().polyline(t,{color:"red"}).addTo(this.map)}catch(a){console.log(a)}})).catch((e=>{console.log(e)}))}},created(){this.retrieveDataOfRelation(1901010)},mounted(){this.map=v().map("mapContainer").setView([20.5362,105.9851],10),v().tileLayer("https://api.mapbox.com/styles/v1/dkhang233/clqdt6l9t00e301o9hcqthyz3/tiles/256/{z}/{x}/{y}@2x?access_token=pk.eyJ1IjoiZGtoYW5nMjMzIiwiYSI6ImNscWQ3bzk2djA5ejIya3BuYXM4dm11NWMifQ.EgYHhPNYsqKwlrX_GKOzAw",{maxZoom:18,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors and  ©<a href="http://mapbox.com">Mapbox</a>'}).addTo(this.map)},onBeforeUnmount(){this.map&&this.map.remove()}},V=a(89);const W=(0,V.Z)(_,[["render",g]]);var C=W,N={components:{MapView:C},data(){return{defaultProps:{value:"code",children:"children",label:"fullName"},filterText:"",treeData:[],dialogFormVisible:!1,form:{code:"",level:"",name:"",subName:""},rules:{name:[{validator:this.checkAdministrationName,trigger:"change"},{validator:this.checkAdministrationSub,trigger:"change"}]},loadingStatus:!1}},watch:{filterText(e){this.$refs.treeRef.filter(e)}},computed:{...(0,c.Kc)(p.L)},methods:{filterNode(e,t){return!e||t.fullName.includes(e)},showNode(e){this.form.code=e.code,this.form.name=e.name,this.form.level=e.levelName,this.form.subName=e.subordinateName,this.dialogFormVisible=!0},checkAdministrationName(e,t,a){if(!t)return a(new Error("Vui lòng nhập mã hành chính"));a()},checkAdministrationSub(e,t,a){if(!t)return a(new Error("Vui lòng trực thuộc"));a()},updateBtn(e){e&&e.validate((e=>{if(!e)return console.log("error submit!"),!1;this.$confirm("Cập nhập đơn vị hành chính này. Tiếp tục?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{this.updateAdministration(),this.dialogFormVisible=!1})).catch((()=>{}))}))},deleteBtn(){this.$confirm("Xóa đơn vị hành chính này. Tiếp tục?","Cảnh báo",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{this.dialogFormVisible=!1,this.$notify({title:"Thành công",message:"Xóa thành công",type:"success"})})).catch((()=>{}))},retrieveAdministrations(){(0,u.bC)(35).then((e=>{this.treeData=e.data,this.loadingStatus=!1})).catch((e=>console.log(e)))},updateAdministration(){this.loadingStatus=!0,(0,u.sE)(this.form.code,{name:this.form.name,subordinateName:this.form.subName,administrativeLevelName:this.form.level}).then((e=>{this.loadingStatus=!1,this.$notify({title:"Thành công",message:"Cập nhập thành công",type:"success"}),this.retrieveAdministrations()})).catch((e=>{this.loadingStatus=!1,this.$notify({title:"Thất bại",message:"Cập nhập thất bại",type:"error"}),this.$notify({title:"Đã xảy ra lỗi",message:e.response.data.messages,type:"error"}),console.log(e)}))}},created(){this.retrieveAdministrations()}};const k=(0,V.Z)(N,[["render",m],["__scopeId","data-v-251c66d4"]]);var T=k}}]);
//# sourceMappingURL=58.3ade2464.js.map