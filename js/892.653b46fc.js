"use strict";(self["webpackChunkforest_resources_manage_application"]=self["webpackChunkforest_resources_manage_application"]||[]).push([[892],{2892:function(e,a,t){t.r(a),t.d(a,{default:function(){return V}});var l=t(3396),r=t(9242),i=t(7520);const o={class:"text-[#2C3E50] text-[25px] font-bold m-3"},s={class:"col-span-3"},n=["src"],m={class:"col-start-5 col-span-10"},d={class:"grid grid-cols-2 gap-5"},h={class:"grid grid-cols-2 gap-5"},c={class:"grid grid-cols-2 gap-5"},u={class:"grid grid-cols-16 gap-4"},p=(0,l._)("span",null,"Tạo mới",-1);function f(e,a,t,f,g,w){const b=(0,l.up)("font-awesome-icon"),v=(0,l.up)("el-col"),y=(0,l.up)("el-row"),k=(0,l.up)("el-table-column"),V=(0,l.up)("el-input"),_=(0,l.up)("el-switch"),U=(0,l.up)("el-button"),C=(0,l.up)("el-table"),x=(0,l.up)("el-card"),F=(0,l.up)("el-form-item"),W=(0,l.up)("el-date-picker"),T=(0,l.up)("el-option"),B=(0,l.up)("el-select"),D=(0,l.up)("el-form"),N=(0,l.up)("el-dialog"),$=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{offset:2},{default:(0,l.w5)((()=>[(0,l._)("h1",o,[(0,l.Wm)(b,{class:"margin-right: 10px",icon:["fas","users-gear"],size:"lg"}),(0,l.Uk)(" Quản lí tài khoản người dùng ")])])),_:1})])),_:1}),(0,l.wy)(((0,l.wg)(),(0,l.j4)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{span:20,offset:2},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{class:"h-[530px] rounded-[50px] mb-2",shadow:"always"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{data:g.filterTableData,class:"h-[530px] w-[93rem]",fit:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{label:"Họ",prop:"firstName",align:"center"}),(0,l.Wm)(k,{label:"Tên",prop:"lastName",align:"center"}),(0,l.Wm)(k,{label:"Username",prop:"username",align:"center"}),(0,l.Wm)(k,{label:"Vai trò",prop:"username",align:"center"}),(0,l.Wm)(k,{label:"Trực thuộc (mã)",prop:"administrationCode",align:"center"}),(0,l.Wm)(k,{"min-width":120,align:"center"},{header:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.search,"onUpdate:modelValue":a[0]||(a[0]=e=>g.search=e),size:"large",placeholder:"Tìm kiếm theo username"},null,8,["modelValue"])])),default:(0,l.w5)((a=>[(0,l.Wm)(_,{modelValue:a.row.isActive,"onUpdate:modelValue":e=>a.row.isActive=e,onChange:t=>w.changeUserStatus(e.index,a.row),loading:a.row.loading,style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue","onUpdate:modelValue","onChange","loading"]),(0,l.Wm)(U,{onClick:e=>w.handleClickEdit(a.$index,a.row)},{default:(0,l.w5)((()=>[(0,l.Uk)("Chi tiết")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])),_:1}),(0,l.Wm)(N,{class:"block rounded-lg bg-white p-6 shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] dark:bg-neutral-700",top:"2vh",modelValue:g.dialogFormVisible,"onUpdate:modelValue":a[15]||(a[15]=e=>g.dialogFormVisible=e),title:w.formTitle,"before-close":w.handleCancel},{footer:(0,l.w5)((()=>[(0,l._)("span",u,["update"==g.formType?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"p-2 col-start-12 font-sans font-bold text-sm text-white rounded-lg shadow-lg px-5 bg-blue-500 shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:a[13]||(a[13]=e=>w.handleUpdate(this.$refs.ruleFormRef))}," Cập nhập ")):(0,l.kq)("",!0),"create"==g.formType?((0,l.wg)(),(0,l.iD)("button",{key:1,class:"p-2 col-start-12 font-sans font-bold text-sm text-white rounded-lg shadow-lg px-5 bg-blue-500 shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:a[14]||(a[14]=e=>w.handleCreate(this.$refs.ruleFormRef))}," Tạo mới ")):(0,l.kq)("",!0)])])),default:(0,l.w5)((()=>[(0,l.Wm)(D,{class:"grid grid-cols-10",ref:"ruleFormRef",model:g.form,"status-icon":"",rules:g.rules,size:"default","label-position":"top"},{default:(0,l.w5)((()=>[(0,l._)("div",s,[(0,l.Wm)(F,{class:"",prop:"avatar"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l._)("input",{ref:"uploadInput",onChange:a[1]||(a[1]=(...e)=>w.handleFileChange&&w.handleFileChange(...e)),type:"file"},null,544),[[r.F8,!1]]),""==g.form.avatar?((0,l.wg)(),(0,l.iD)("img",{key:0,onClick:a[2]||(a[2]=(...e)=>w.openFileInput&&w.openFileInput(...e)),class:"rounded-full shadow-lg hover:cursor-pointer hover:opacity-60",src:i})):(0,l.kq)("",!0),""!=g.form.avatar?((0,l.wg)(),(0,l.iD)("img",{key:1,onClick:a[3]||(a[3]=(...e)=>w.openFileInput&&w.openFileInput(...e)),class:"rounded-full shadow-lg",src:w.userAvatar},null,8,n)):(0,l.kq)("",!0),""!=g.form.avatar?((0,l.wg)(),(0,l.j4)(b,{key:2,class:"shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] p-2 hover:cursor-pointer hover:opacity-60 hover:text-red-600",onClick:w.resetAvatar,icon:["fas","trash-can"],size:"lg"},null,8,["onClick"])):(0,l.kq)("",!0)])),_:1})]),(0,l._)("div",m,[(0,l.Wm)(F,{label:"Username",prop:"username"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.username,"onUpdate:modelValue":a[4]||(a[4]=e=>g.form.username=e),disabled:"update"==g.formType},null,8,["modelValue","disabled"])])),_:1}),"create"==g.formType?((0,l.wg)(),(0,l.j4)(F,{key:0,label:"Mật khẩu",prop:"password"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{type:"password","show-password":"",modelValue:g.form.password,"onUpdate:modelValue":a[5]||(a[5]=e=>g.form.password=e)},null,8,["modelValue"])])),_:1})):(0,l.kq)("",!0),(0,l._)("div",d,[(0,l.Wm)(F,{label:"Họ",prop:"firstName"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.firstName,"onUpdate:modelValue":a[6]||(a[6]=e=>g.form.firstName=e)},null,8,["modelValue"])])),_:1}),(0,l.Wm)(F,{label:"Tên",prop:"lastName"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.lastName,"onUpdate:modelValue":a[7]||(a[7]=e=>g.form.lastName=e)},null,8,["modelValue"])])),_:1})]),(0,l.Wm)(F,{label:"Email",prop:"email"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.email,"onUpdate:modelValue":a[8]||(a[8]=e=>g.form.email=e)},null,8,["modelValue"])])),_:1}),(0,l._)("div",h,[(0,l.Wm)(F,{label:"Ngày sinh",prop:"birthDate"},{default:(0,l.w5)((()=>[(0,l.Wm)(W,{modelValue:g.form.birthDate,"onUpdate:modelValue":a[9]||(a[9]=e=>g.form.birthDate=e),type:"date",placeholder:"Chọn ngày sinh",size:"default"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(F,{label:"Địa chỉ",prop:"address"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.address,"onUpdate:modelValue":a[10]||(a[10]=e=>g.form.address=e)},null,8,["modelValue"])])),_:1})]),(0,l._)("div",c,[(0,l.Wm)(F,{label:"Vai trò",prop:"role"},{default:(0,l.w5)((()=>[(0,l.Wm)(B,{modelValue:g.form.role,"onUpdate:modelValue":a[11]||(a[11]=e=>g.form.role=e),placeholder:"Chọn vai trò"},{default:(0,l.w5)((()=>[(0,l.Wm)(T,{label:"User",value:"user"}),(0,l.Wm)(T,{label:"Admin",value:"admin"})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(F,{label:"Trực thuộc (mã)",prop:"administrationCode"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:g.form.administrationCode,"onUpdate:modelValue":a[12]||(a[12]=e=>g.form.administrationCode=e)},null,8,["modelValue"])])),_:1})])])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title","before-close"])])),_:1})])),_:1})),[[$,g.loadingStatus]]),(0,l.Wm)(y,null,{default:(0,l.w5)((()=>[(0,l.Wm)(v,{offset:2},{default:(0,l.w5)((()=>[(0,l._)("button",{class:"w-full md:w-auto flex justify-center items-center p-3 mt-3 ml-4 space-x-4 font-sans font-bold text-white rounded-[10px] shadow-lg px-9 bg-blue-500 shadow-blue-100 hover:bg-opacity-90 hover:shadow-lg border transition hover:-translate-y-0.5 duration-150",onClick:a[16]||(a[16]=(...e)=>w.createNewUser&&w.createNewUser(...e))},[(0,l.Wm)(b,{icon:["fas","plus"],size:"lg"}),p])])),_:1})])),_:1})],64)}t(8858),t(1318),t(3228);var g=t(2900),w=t(7322),b=t(1020),v={data(){return{loadingStatus:!1,search:"",tableData:[],filterTableData:[],dialogFormVisible:!1,form:{username:"",password:"",firstName:"",lastName:"",email:"",avatar:"",address:"",birthDate:"",role:"",isActive:!0,administrationCode:""},formBackUp:null,avatarFile:null,formType:"update",rules:{username:[{validator:this.checkEmptyField,trigger:"blur"}],password:[{validator:this.checkEmptyField,trigger:"blur"}],email:[{validator:this.checkEmail,trigger:"blur"}],role:[{validator:this.checkEmptyField,trigger:"blur"}],administrationCode:[{validator:this.checkEmptyField,trigger:"blur"}]}}},computed:{...(0,b.Kc)(w.L),userAvatar(){return this.form.avatar.includes("http://")?this.form.avatar:g.yA+this.form.avatar},formTitle(){return"update"==this.formType?"Thông tin chi tiết":"Tạo người dùng mới"}},watch:{search(e){this.filterTableData=this.tableData.filter((a=>!e||a.username.toLowerCase().includes(e.toLowerCase())))}},methods:{retrieveData(){this.loadingStatus=!0,g.S2().then((e=>{this.tableData=e.data,this.filterTableData=this.tableData,this.loadingStatus=!1})).catch((e=>console.log(e)))},createNewUser(){this.formType="create",this.resetFormData(),null!=this.$refs.ruleFormRef&&this.$refs.ruleFormRef.clearValidate(),this.formBackUp={username:this.form.username,firstName:this.form.firstName,lastName:this.form.lastName,email:this.form.email,avatar:this.form.avatar,address:this.form.address,birthDate:this.form.birthDate,role:this.form.role,isActive:this.form.isActive,administrationCode:this.form.administrationCode},this.dialogFormVisible=!0},handleCreate(e){e&&e.validate((e=>{if(!e)return!1;this.$confirm("Tạo mới tài khoản. Tiếp tục?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{this.loadingStatus=!0;let e=new FormData;e.append("avatar-file",this.avatarFile);let a=JSON.stringify(this.form);const t=new Blob([a],{type:"application/json"});e.append("body",t),g.r4(e).then((e=>{this.loadingStatus=!1,this.$notify({title:"Thành công",message:"Tạo tài khoản thành công",type:"success"}),this.retrieveData()})).catch((e=>{this.loadingStatus=!1,this.$notify({title:"Đã xảy ra lỗi",message:e.response.data.messages,type:"error"}),console.log(e.message)})),this.dialogFormVisible=!1})).catch((e=>{console.log(e)}))}))},handleClickEdit(e,a){null!=this.$refs.ruleFormRef&&this.$refs.ruleFormRef.clearValidate(),this.formType="update",this.form=a,this.formBackUp={username:this.form.username,firstName:this.form.firstName,lastName:this.form.lastName,email:this.form.email,avatar:this.form.avatar,address:this.form.address,birthDate:this.form.birthDate,role:this.form.role,isActive:this.form.isActive,administrationCode:this.form.administrationCode},this.dialogFormVisible=!0},openFileInput(){this.$refs.uploadInput.value=null,this.$refs.uploadInput.click()},handleFileChange(e){let a=e.target.files[0];if(a.type.startsWith("image")){if(a.size/1024/1024>1)this.$message.error("Vui lòng chọn file ảnh có kích thước nhỏ hơn 1MB");else if(this.avatarFile=a,null!=a){let e=URL.createObjectURL(a);this.form.avatar=e}}else this.$message.error("Vui lòng chọn file ảnh")},resetAvatar(){this.form.avatar="",this.avatarFile=null},handleDelete(e,a){console.log(e,a),this.$confirm("Xóa thông tin này. Tiếp tục?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{console.log("submit!"),this.dialogFormVisible=!1})).catch((()=>{}))},handleCancel(){this.form.username==this.formBackUp.username&&this.form.firstName==this.formBackUp.firstName&&this.form.lastName==this.formBackUp.lastName&&this.form.email==this.formBackUp.email&&this.form.avatar==this.formBackUp.avatar&&this.form.address==this.formBackUp.address&&this.form.birthDate==this.formBackUp.birthDate&&this.form.role==this.formBackUp.role&&this.form.isActive==this.formBackUp.isActive&&this.form.administrationCode==this.formBackUp.administrationCode?this.dialogFormVisible=!1:this.$confirm("Hủy bỏ thay đổi. Tiếp tục?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{null!=this.formBackUp&&(this.form.username=this.formBackUp.username,this.form.firstName=this.formBackUp.firstName,this.form.lastName=this.formBackUp.lastName,this.form.email=this.formBackUp.email,this.form.avatar=this.formBackUp.avatar,this.form.address=this.formBackUp.address,this.form.birthDate=this.formBackUp.birthDate,this.form.role=this.formBackUp.role,this.form.isActive=this.formBackUp.isActive,this.form.administrationCode=this.formBackUp.administrationCode),this.dialogFormVisible=!1})).catch((()=>{}))},handleUpdate(e){e&&e.validate((e=>{if(!e)return!1;this.$confirm("Cập nhập thông tin này. Tiếp tục?","Xác nhận",{confirmButtonText:"OK",cancelButtonText:"Hủy",type:"warning"}).then((()=>{this.loadingStatus=!0;let e=new FormData;e.append("avatar-file",this.avatarFile);let a=JSON.stringify(this.form);const t=new Blob([a],{type:"application/json"});e.append("body",t),g.pj(this.form.username,e).then((e=>{this.loadingStatus=!1,this.$notify({title:"Thành công",message:"Cập nhập thành công",type:"success"})})).catch((e=>{let a="";try{a=e.response.data.messages}catch(t){console.log(e)}this.loadingStatus=!1,this.$notify({title:"Đã xảy ra lỗi",message:a,type:"error"})})),this.dialogFormVisible=!1})).catch((e=>{console.log(e)}))}))},changeUserStatus(e,a){a.loading=!0;let t=new FormData;t.append("avatar-file",this.avatarFile);let l=JSON.stringify(a);const r=new Blob([l],{type:"application/json"});t.append("body",r),updateUser(a.username,t).then((e=>(a.loading=!1,this.$notify({title:"Thành công",message:"Cập nhập thành công",type:"success"}),!0))).catch((e=>{a.loading=!1,a.isActive=!a.isActive;let t="";try{t=e.response.data.messages}catch(l){console.log(e)}return this.$notify({title:"Đã xảy ra lỗi",message:t,type:"error"}),!1}))},resetFormData(){this.form={username:"",password:"",firstName:"",lastName:"",email:"",avatar:"",avatarFile:null,address:"",birthDate:"",role:"",isActive:!0,administrationCode:""}},checkEmptyField(e,a,t){return null==a||/^\s*$/.test(a)?t(new Error("Vui lòng nhập thông tin này")):t()},checkEmail(e,a,t){""===a?t(new Error("Vui lòng nhập email")):(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(a)&&t(),t(new Error("Vui lòng nhập đúng địa chỉ email")))}},created(){this.retrieveData()}},y=t(89);const k=(0,y.Z)(v,[["render",f]]);var V=k},7520:function(e,a,t){e.exports=t.p+"img/default-avatar.2490029f.png"}}]);
//# sourceMappingURL=892.653b46fc.js.map